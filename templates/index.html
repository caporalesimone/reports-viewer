<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Index</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css">
    <style>
        .breadcrumb {
            background-color: transparent;
            padding: 0;
            margin: 0;
        }
        .breadcrumb-item {
            cursor: pointer;
        }
        .breadcrumb-item.active {
            font-weight: bold;
            color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h1>Report Index</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" id="breadcrumb">
                <!-- Dynamic breadcrumbs will be generated here -->
            </ol>
        </nav>
        <div id="content">
            <!-- Dynamic content will be generated here -->
        </div>
    </div>

    <script>
        // Current navigation state
        let currentPath = [];
        let indexData = {};

        // Function to load the index
        async function loadIndex() {
            const response = await fetch('/api/index');
            indexData = await response.json();
            renderContent(indexData);
        }

        // Function to render the breadcrumb and content
        function renderBreadcrumb() {
            const breadcrumb = document.getElementById('breadcrumb');
            breadcrumb.innerHTML = '';

            currentPath.forEach((segment, index) => {
                const breadcrumbItem = document.createElement('li');
                breadcrumbItem.className = 'breadcrumb-item';
                if (index === currentPath.length - 1) {
                    breadcrumbItem.classList.add('active');
                    breadcrumbItem.textContent = segment.displayName;
                } else {
                    breadcrumbItem.textContent = segment.displayName;
                    breadcrumbItem.onclick = () => {
                        currentPath = currentPath.slice(0, index + 1);
                        renderContent(getDataAtPath(currentPath));
                    };
                }
                breadcrumb.appendChild(breadcrumbItem);
            });
        }

        // Function to get data corresponding to the current path
        function getDataAtPath(path) {
            let data = indexData;
            for (const segment of path) {
                data = data[segment.key];
            }
            return data;
        }

        // Function to render content based on the current level
        function renderContent(data) {
            const content = document.getElementById('content');
            content.innerHTML = '';
            renderBreadcrumb();

            if (typeof data === 'string') {
                // Show the link to the HTML report
                const link = document.createElement('a');
                link.href = `/${data}`;
                link.target = '_blank';
                link.textContent = 'View Report';
                content.appendChild(link);
                return;
            }

            // Create a clickable options list
            const listGroup = document.createElement('ul');
            listGroup.className = 'list-group';

            Object.keys(data).forEach(key => {
                const item = document.createElement('li');
                item.className = 'list-group-item list-group-item-action';
                let displayName = key;

                // If the element is a file (a link), add it directly
                if (typeof data[key] === 'string') {
                    const link = document.createElement('a');
                    link.href = `/${data[key]}`;
                    link.target = '_blank';
                    link.textContent = `${displayName} - Run report`;
                    item.appendChild(link);
                } else {
                    item.textContent = displayName;
                    item.onclick = () => {
                        currentPath.push({ key: key, displayName: displayName });
                        renderContent(data[key]);
                    };
                }

                listGroup.appendChild(item);
            });

            content.appendChild(listGroup);
        }

        // Initialization
        loadIndex();
    </script>
</body>
</html>
