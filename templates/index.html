<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .tabs {
            display: flex;
            margin-top: 20px;
            border-bottom: 2px solid #ddd;
            cursor: pointer;
            justify-content: center;
        }
        .tab {
            padding: 10px 20px;
            margin-right: 5px;
            border: 1px solid #ddd;
            border-bottom: none;
            background-color: #e0e0e0;
        }
        .tab.active {
            background-color: #5f9ea0;
            color: #fff;
        }
        .tree-view {
            margin-top: 20px;
            padding: 0 20px;
        }
        .tree-item {
            margin-left: 15px;
            cursor: pointer;
        }
        .tree-item a {
            text-decoration: none;
            color: #007bff;
        }
        .tree-item a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <h1>Report Viewer</h1>
    <div class="tabs" id="tabs"></div>
    <div id="treeContainer"></div>

    <script>
        let indexData = {};

        async function loadIndex() {
            try {
                const response = await fetch('/api/index');
                indexData = await response.json();
                renderTabs(indexData);
            } catch (error) {
                console.error("Errore durante il caricamento dell'indice:", error);
            }
        }

        function renderTabs(data) {
            const tabsContainer = document.getElementById('tabs');
            tabsContainer.innerHTML = '';
            
            Object.keys(data).forEach((tag, index) => {
                const tab = document.createElement('div');
                tab.classList.add('tab');
                if (index === 0) tab.classList.add('active');
                tab.innerText = tag;
                
                tab.onclick = () => {
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    renderTree(data[tag]);
                };

                tabsContainer.appendChild(tab);
            });

            renderTree(Object.values(data)[0]);
        }

        function createTree(obj, level = 0) {
    const container = document.createElement('div');
    container.classList.add('tree-view');

    Object.keys(obj).forEach(key => {
        const item = document.createElement('div');
        item.classList.add('tree-item');

        if (typeof obj[key] === 'string') {
            const link = document.createElement('a');
            link.href = obj[key];
            link.target = '_blank';
            link.innerText = key;
            item.appendChild(link);
        } else {
            item.innerHTML = `<strong>${key}</strong>`;
            const childrenContainer = createTree(obj[key], level + 1);

            // Espande automaticamente solo il livello "Anno" (livello 0)
            if (level === 0) {
                childrenContainer.style.display = 'block';
            } else {
                childrenContainer.style.display = 'none';
                item.onclick = (event) => {
                    event.stopPropagation();
                    childrenContainer.style.display = 
                        childrenContainer.style.display === 'none' ? 'block' : 'none';
                };
            }

            item.appendChild(childrenContainer);
        }

        container.appendChild(item);
    });

    return container;
}


        function renderTree(treeData) {
            const treeContainer = document.getElementById('treeContainer');
            treeContainer.innerHTML = '';
            treeContainer.appendChild(createTree(treeData));
        }

        loadIndex();
    </script>
</body>
</html>
